<!DOCTYPE html>
<html lang="hu" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Eszes Tiszta Klíma Kft.</title>
  <link rel="icon" href="https://i.postimg.cc/xTYhg4gG/image.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <!-- Leaflet (map) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    body{font-family:'Inter',sans-serif}
    .hero-bg{position:relative;background-image:url('https://i.postimg.cc/3J1W66pj/fdsffsf.jpg');background-size:cover;background-position:center}
    .hero-bg::before{content:'';position:absolute;inset:0;background-color:rgba(0,74,111,.7);z-index:1}
    .hero-content{position:relative;z-index:2}
    .text-shadow{ text-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.06)}
    .text-shadow-md{ text-shadow:0 2px 4px rgba(0,0,0,.2)}
    .text-shadow-strong{ text-shadow:0px 1px 4px rgba(0,0,0,.8)}

    .reveal-on-scroll{opacity:0;transform:translateY(30px);transition:opacity .8s ease-out,transform .8s ease-out;transition-delay:var(--delay,0ms)}
    .reveal-on-scroll.is-visible{opacity:1;transform:translateY(0)}

    #header-container,#header-logo,#header-company-name,#main-nav,#mobile-menu-button{transition:all .5s cubic-bezier(.65,0,.35,1)}
    #header-container{justify-content:space-between}
    #main-header .max-w-6xl{text-align:center}
    .header-scrolled #main-nav,.header-scrolled #mobile-menu-button{opacity:0;max-width:0;padding:0;margin:0;flex-basis:0;overflow:hidden}
    .header-scrolled #header-container{display:inline-flex;justify-content:center;padding-inline:1rem}
    .header-scrolled #header-logo{height:1.75rem}
    .header-scrolled #header-company-name{font-size:1.125rem}

    /* ===== Reviews – MAX láthatóság ===== */
    .reviews-strip{
      position: relative;
      background: linear-gradient(to bottom, rgba(0,32,48,.92), rgba(0,32,48,.96));
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      overflow: hidden;
    }
    .reviews-strip::before,
    .reviews-strip::after{
      content:"";
      position:absolute; top:0; bottom:0; width:72px; z-index:2; pointer-events:none;
    }
    .reviews-strip::before{
      left:0;
      background: linear-gradient(to right, rgba(0,32,48,.85), rgba(0,32,48,0));
    }
    .reviews-strip::after{
      right:0;
      background: linear-gradient(to left, rgba(0,32,48,.85), rgba(0,32,48,0));
    }
    #reviews-container{
      display:inline-flex;
      gap:1rem;
      align-items:center;
      padding-inline:1rem;
      white-space:nowrap;
    }
    .review-card{
      display:inline-flex; align-items:center; gap:.6rem;
      color:#fff;
      background: linear-gradient(to bottom, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.50);
      border-radius:9999px;
      box-shadow: 0 8px 18px rgba(0,0,0,.35);
      padding:.55rem .9rem;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .review-quote{
      width:26px;height:26px;border-radius:9999px;
      display:inline-flex;align-items:center;justify-content:center;
      background: rgba(255,255,255,.18);
    }
    .review-text{ font-weight:700; letter-spacing:.1px; text-shadow: 0 1px 2px rgba(0,0,0,.6); }
    .review-meta{ opacity:1; font-weight:600; }
    .marquee{ animation: marquee 40s linear infinite; will-change: transform; }
    @media (hover:hover){ .marquee:hover{ animation-play-state: paused; } }
    @keyframes marquee{ from{ transform:translateX(0); } to{ transform:translateX(-50%); } }

    /* --- Térkép stílus --- */
    #work-map{ width:100%; height:520px; border-radius:16px; box-shadow:0 20px 45px rgba(0,0,0,.25); overflow:hidden; }
    @media (max-width:640px){ #work-map{ height:400px; } }
    .leaflet-tooltip.county-label{
      background:transparent; border:none; box-shadow:none;
      color:#0b1f2a; font-weight:800; letter-spacing:.2px; text-shadow:0 1px 2px rgba(255,255,255,.8);
    }
    .leaflet-container .leaflet-control-attribution{ display:none; }
    .county-outline{ filter: drop-shadow(0 2px 8px rgba(0,0,0,.35)); }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- Navigáció -->
  <header id="main-header" class="fixed top-0 left-0 right-0 z-50 p-4">
    <div class="max-w-6xl mx-auto">
      <div id="header-container" class="bg-white/80 backdrop-blur-xl shadow-lg rounded-full px-4 sm:px-6 py-2 flex items-center">
        <a href="#" class="flex items-center">
          <img id="header-logo" src="https://i.postimg.cc/xTYhg4gG/image.png" alt="Cég logó" class="h-8 mr-2 sm:mr-3">
          <span id="header-company-name" class="text-base sm:text-xl font-bold text-yellow-600 text-shadow-md">Eszes Tiszta Klíma Kft.</span>
        </a>

        <nav id="main-nav" class="hidden md:flex items-center space-x-2">
          <a href="#szolgaltatasok" class="text-gray-700 hover:text-cyan-700 px-4 py-2 rounded-full transition duration-300 font-semibold text-shadow">Szolgáltatások</a>
          <a href="#munkaink" class="text-gray-700 hover:text-cyan-700 px-4 py-2 rounded-full transition duration-300 font-semibold text-shadow">Munkáink</a>
          <a href="#rolunk" class="text-gray-700 hover:text-cyan-700 px-4 py-2 rounded-full transition duration-300 font-semibold text-shadow">Rólunk</a>
          <a href="#kapcsolat" class="bg-cyan-600 text-white px-5 py-2 rounded-full font-semibold hover:bg-cyan-700 transition duration-300 shadow-md text-shadow-md">Időpontfoglalás</a>
        </nav>

        <button id="mobile-menu-button" class="md:hidden text-gray-700 focus:outline-none">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/></svg>
        </button>
      </div>

      <div id="mobile-menu" class="hidden md:hidden bg-white/90 backdrop-blur-lg mt-2 rounded-2xl shadow-lg overflow-hidden">
        <a href="#szolgaltatasok" class="block text-center py-3 px-4 text-sm text-gray-600 hover:bg-cyan-50 font-semibold">Szolgáltatások</a>
        <a href="#munkaink" class="block text-center py-3 px-4 text-sm text-gray-600 hover:bg-cyan-50 font-semibold">Munkáink</a>
        <a href="#rolunk" class="block text-center py-3 px-4 text-sm text-gray-600 hover:bg-cyan-50 font-semibold">Rólunk</a>
        <a href="#kapcsolat" class="block text-center py-4 px-4 text-sm bg-cyan-600 text-white font-semibold hover:bg-cyan-700">Időpontfoglalás</a>
      </div>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero-bg text-white relative overflow-hidden">
      <div class="hero-content container mx-auto px-6 pt-32 pb-28 md:pt-40 md:pb-24 text-center">
        <h1 class="text-4xl md:text-6xl font-black leading-tight mb-4 reveal-on-scroll">Tökéletes klíma otthonodba 48 órán belül</h1>
        <p class="text-lg md:text-xl mb-8 max-w-3xl mx-auto text-gray-200 reveal-on-scroll" style="--delay:200ms">Forró nyarak és hideg telek ellen – mi gondoskodunk az otthonod kényelméről Siófokon és környékén.</p>
        <div class="mt-10 reveal-on-scroll" style="--delay:400ms">
          <a href="#kapcsolat" class="bg-yellow-400 text-gray-900 px-8 py-4 rounded-full font-bold text-lg hover:bg-yellow-300 transition duration-300 shadow-xl inline-block">Ingyenes ajánlat</a>
        </div>
      </div>
      <!-- Reviews sáv -->
      <div class="reviews-strip absolute bottom-0 left-0 right-0 py-4">
        <div class="w-full flex">
          <div id="reviews-container" class="marquee items-center"></div>
        </div>
      </div>
    </section>

    <!-- Szolgáltatások -->
    <section id="szolgaltatasok" class="py-20">
      <div class="container mx-auto px-6">
        <h2 class="text-4xl md:text-5xl font-black text-center mb-12 text-cyan-800 reveal-on-scroll">Szolgáltatásaink</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 border border-gray-200 reveal-on-scroll">
            <div class="bg-cyan-100 text-cyan-700 rounded-full w-16 h-16 flex items-center justify-center mb-6">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
            </div>
            <h3 class="text-xl md:text-2xl font-bold mb-3">Klíma Telepítés</h3>
            <p class="text-gray-600 leading-relaxed">Modern, energiahatékony klímaberendezések szakszerű telepítése. Segítünk a megfelelő készülék kiválasztásában és a komplett kivitelezésben, garanciával.</p>
          </div>

          <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 border border-gray-200 reveal-on-scroll" style="--delay:150ms">
            <div class="bg-cyan-100 text-cyan-700 rounded-full w-16 h-16 flex items-center justify-center mb-6">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
            </div>
            <h3 class="text-xl md:text-2xl font-bold mb-3">Tisztítás és Karbantartás</h3>
            <p class="text-gray-600 leading-relaxed"><span class="font-bold">Hogy miért fontos?</span><br>Ne legyen <strong class="text-red-600">poros, gombás, penészes</strong> a beltéri! Az elhanyagolt klíma akár <strong class="text-red-600">egészségre is káros lehet</strong>, de az elszennyeződött hőcserélő rontja a hatásfokot, <strong class="text-red-600">több energiát</strong> fogyaszt és <strong class="text-red-600">meghibásodáshoz</strong> vezethet.</p>
          </div>

          <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 border border-gray-200 reveal-on-scroll" style="--delay:300ms">
            <div class="bg-cyan-100 text-cyan-700 rounded-full w-16 h-16 flex items-center justify-center mb-6">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/><path stroke-linecap="round" stroke-linejoin="round" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/></svg>
            </div>
            <h3 class="text-xl md:text-2xl font-bold mb-3">Javítás és Hibaelhárítás</h3>
            <p class="text-gray-600 leading-relaxed">Meghibásodott a klímája? Márkafüggetlen szervizelést biztosítunk, rövid határidővel Siófok és környékén. Hívjon bizalommal!</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Munkáink -->
    <section id="munkaink" class="py-20 bg-cyan-700 text-white overflow-hidden">
      <div class="container mx-auto px-6">
        <h2 class="text-4xl md:text-5xl font-black text-center mb-4 text-white reveal-on-scroll">Aktuális Munkáink</h2>
        <p class="text-center text-lg text-cyan-100 mb-12 max-w-2xl mx-auto reveal-on-scroll" style="--delay:150ms">Minden klímánk mögött egy elégedett ügyfél áll!</p>

        <div id="gallery-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
          <p class="text-center col-span-full">Galéria betöltése...</p>
        </div>

        <!-- ÚJ: Térkép blokk -->
        <div class="mt-16 reveal-on-scroll" style="--delay:300ms;">
          <h3 class="text-2xl font-bold text-center text-white mb-6">Ahol már dolgoztunk (megye térkép)</h3>

          <div id="work-map" class="mx-auto max-w-5xl"></div>

          <div class="flex items-center justify-center gap-4 mt-4 text-cyan-100 text-sm">
            <span class="inline-flex items-center gap-2">
              <span class="inline-block w-4 h-4 rounded-sm" style="background:#16a34a; border:1px solid #15803d"></span>
              Volt munkánk ebben a megyében
            </span>
            <span class="inline-flex items-center gap-2">
              <span class="inline-block w-4 h-4 rounded-sm" style="background:#e5e7eb; border:1px solid #ffffff"></span>
              Még nincs jelölés
            </span>
          </div>
        </div>
      </div>
    </section>

    <!-- Rólunk -->
    <section id="rolunk" class="py-20">
      <div class="container mx-auto px-6">
        <div class="flex flex-col md:flex-row items-center gap-12">
          <div class="md:w-1/2 reveal-on-scroll">
            <img src="https://i.postimg.cc/4yCkJ4zj/20250705-112625.jpg" alt="Barátságos klímaszerelő csapat" class="rounded-2xl shadow-2xl w-full">
          </div>
          <div class="md:w-1/2 reveal-on-scroll" style="--delay:200ms">
            <h2 class="text-4xl md:text-5xl font-black mb-6 text-cyan-800 text-center">Rólunk</h2>
            <div class="bg-white p-6 rounded-xl shadow-lg">
              <div class="space-y-4 text-gray-700 text-base md:text-lg leading-relaxed">
                <p>Az Eszes Tiszta Klíma Kft. egy családi vállalkozás, ahol a tiszta és megbízható klímákért dolgozunk.</p>
                <p>A rendszeres tisztítás és karbantartás növeli az élettartamot, csökkenti a fogyasztást, és egészségesebb beltéri levegőt ad.</p>
                <p>Egyéni vállalkozásként indultunk, ma már csapatban dolgozunk — több ezer karbantartás és több száz telepítés tapasztalatával.</p>
              </div>
              <blockquote class="border-l-4 border-yellow-400 pl-4 italic mt-6 text-xl text-gray-800 font-semibold">Mottónk: Legyen a te klímád is tiszta!</blockquote>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Kapcsolat -->
    <section id="kapcsolat" class="py-20 bg-cyan-700 text-white">
      <div class="container mx-auto px-6 text-center">
        <h2 class="text-4xl md:text-5xl font-black mb-4 reveal-on-scroll">Készen áll a tökéletes klímára?</h2>
        <p class="text-xl mb-8 text-cyan-100 reveal-on-scroll" style="--delay:150ms">Hívjon minket bizalommal időpontért vagy egyedi ajánlatért!</p>
        <div class="inline-block bg-white/90 text-cyan-800 rounded-xl p-8 shadow-2xl reveal-on-scroll" style="--delay:300ms">
          <p class="text-lg mb-2">Időpontegyeztetés telefonon:</p>
          <a href="tel:+36709304841" class="text-4xl font-bold hover:text-cyan-600 transition-colors duration-300 flex items-center justify-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.518.759a1.156 1.156 0 00-.43 1.659l4.592 4.592a1 1 0 001.659-.43l.759-1.518a1 1 0 011.06-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/></svg>
            +36 70 930 4841
          </a>
          <p class="mt-4 text-sm text-gray-600">Hívható hétköznap 8:00 és 18:00 között.</p>
        </div>
        <div class="mt-6 reveal-on-scroll" style="--delay:400ms">
          <p class="text-cyan-200">Vagy írjon nekünk e-mailt:</p>
          <a href="mailto:sandor.szanto@gmail.com" class="text-cyan-100 hover:text-white font-semibold transition-colors duration-300">sandor.szanto@gmail.com</a>
        </div>
      </div>
    </section>

    <!-- Vélemény űrlap -->
    <section id="velemeny" class="py-20">
      <div class="container mx-auto px-6">
        <h2 class="text-4xl md:text-5xl font-black text-center mb-12 text-cyan-800 reveal-on-scroll">Mondja el a véleményét!</h2>
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-lg reveal-on-scroll" style="--delay:150ms">
          <h3 class="text-2xl font-bold text-gray-800 text-center mb-6">Ossza meg velünk tapasztalatait!</h3>
          <form id="reviewForm">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label for="reviewerName" class="block mb-2 text-sm font-medium text-gray-600">Neve</label>
                <input id="reviewerName" type="text" class="w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-lg p-3 focus:ring-cyan-500 focus:border-cyan-500" required />
              </div>
              <div>
                <label for="reviewerCity" class="block mb-2 text-sm font-medium text-gray-600">Település</label>
                <input id="reviewerCity" type="text" class="w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-lg p-3 focus:ring-cyan-500 focus:border-cyan-500" required />
              </div>
            </div>
            <div class="mb-6">
              <label for="reviewText" class="block mb-2 text-sm font-medium text-gray-600">Véleménye</label>
              <textarea id="reviewText" rows="4" class="w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-lg p-3 focus:ring-cyan-500 focus:border-cyan-500" required></textarea>
            </div>
            <button id="submitReviewBtn" type="submit" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-6 rounded-full text-lg transition shadow-md">Vélemény elküldése</button>
          </form>
        </div>
      </div>
    </section>
  </main>

  <!-- Lightbox (Képnézegető) -->
  <div id="lightbox" class="fixed inset-0 z-[110] flex items-center justify-center bg-black bg-opacity-80 backdrop-blur-sm hidden transition-opacity duration-300">
    <div id="lightbox-content" class="relative max-w-4xl max-h-[90vh] w-full p-4">
      <button id="close-lightbox" class="absolute -top-2 -right-2 md:top-0 md:-right-10 text-white text-5xl font-bold">&times;</button>
      <img id="lightbox-image" src="" alt="" class="max-w-full max-h-[75vh] mx-auto rounded-lg shadow-2xl">
      <div id="lightbox-caption" class="text-center text-white mt-4">
        <h4 id="lightbox-title" class="text-xl font-bold"></h4>
        <p id="lightbox-description" class="text-gray-300"></p>
      </div>
    </div>
  </div>

  <footer class="bg-gray-800 text-white py-10">
    <div class="container mx-auto px-6 text-center">
      <p class="text-xl font-bold text-white mb-2">Eszes Tiszta Klíma Kft.</p>
      <p class="text-gray-400">&copy; 2025 Minden jog fenntartva.</p>
      <p class="text-sm text-gray-500 mt-4">Powered by: Berceli Bence</p>
    </div>
  </footer>

  <a href="#" id="to-top-button" class="fixed bottom-5 right-5 z-50 w-12 h-12 bg-yellow-400 rounded-full flex items-center justify-center shadow-lg hover:bg-yellow-500 transition-all duration-300 opacity-0 translate-y-5">
    <svg class="w-6 h-6 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg>
  </a>

  <!-- Firebase + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, Timestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB0yin_VnilXLpth-qzNsJqpIwyalirI6M",
      authDomain: "klima-weboldal.firebaseapp.com",
      projectId: "klima-weboldal",
      storageBucket: "klima-weboldal.appspot.com",
      messagingSenderId: "31440003199",
      appId: "1:31440003199:web:13ec2fcd1601861eec5f4a"
    };

    let app, db, auth;
    try { app = initializeApp(firebaseConfig); db = getFirestore(app); auth = getAuth(app); }
    catch(e){ console.error("Firebase init fail", e); }

    const reviewForm = document.getElementById('reviewForm');
    const reviewsContainer = document.getElementById('reviews-container');

    const buildReview = (text, name, city) => `
      <div class="review-card">
        <span class="review-quote"><i class="fa-solid fa-quote-left text-xs"></i></span>
        <span class="review-text">"${text}"</span>
        <span class="review-meta">– ${name}, ${city}</span>
      </div>
    `;

    const loadDefaultReviews = () => {
      const def = [
        {name:"Nagy Család",city:"Siófok",review:"Gyorsak, profik és nagyon tisztán dolgoztak. Végre hűvös van a nappaliban!"},
        {name:"Kiss Péter",city:"Székesfehérvár",review:"Minden a megbeszéltek szerint történt, a klíma tökéletesen működik. Csak ajánlani tudom!"},
        {name:"Horváth Éva",city:"Veszprém",review:"A régi, zajos klímánkat cserélték le egy újra. Hatalmas a különbség, köszönjük!"}
      ];
      let lane=''; def.forEach(r=> lane += buildReview(r.review, r.name, r.city));
      reviewsContainer.innerHTML = lane + lane;
    };

    const escapeHtml = s => String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

    async function loadReviews(){
      reviewsContainer.innerHTML='';
      try{
        const snap = await getDocs(query(collection(db,'reviews'),orderBy('createdAt','desc')));
        if (snap.empty){ loadDefaultReviews(); return; }
        let lane=''; snap.forEach(doc=>{
          const r=doc.data();
          lane += buildReview(escapeHtml(r.text), escapeHtml(r.name), escapeHtml(r.city));
        });
        reviewsContainer.innerHTML = lane + lane;
      }catch{ loadDefaultReviews(); }
    }

    if (auth){
      onAuthStateChanged(auth,(user)=>{
        if(user) loadReviews();
        else signInAnonymously(auth).catch(()=>loadDefaultReviews());
      });
    } else { loadDefaultReviews(); }

    reviewForm?.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!db) { alert("A véleményküldés funkció jelenleg nem elérhető."); return; }
      const btn = document.getElementById('submitReviewBtn');
      btn.disabled = true; btn.textContent = 'Küldés...';

      const name = document.getElementById('reviewerName').value.trim();
      const city = document.getElementById('reviewerCity').value.trim();
      const text = document.getElementById('reviewText').value.trim();
      if (!name || !text || !city) { alert('Töltsön ki minden mezőt!'); btn.disabled=false; btn.textContent='Vélemény elküldése'; return; }

      try {
        await addDoc(collection(db, 'reviews'), { name, city, text, createdAt: Timestamp.now() });
        reviewForm.reset();
        alert('Köszönjük a véleményét!');
        await loadReviews();
      } catch (err) {
        console.error('Hiba a mentéskor:', err);
        alert('Hiba történt a vélemény mentése során.');
      } finally {
        btn.disabled=false; btn.textContent='Vélemény elküldése';
      }
    });
  </script>

  <!-- UI / Galéria / Térkép -->
  <script>
    // Mobil menü
    const mobileMenuButton=document.getElementById('mobile-menu-button');
    const mobileMenu=document.getElementById('mobile-menu');
    mobileMenuButton?.addEventListener('click',()=>mobileMenu.classList.toggle('hidden'));
    mobileMenu?.querySelectorAll('a').forEach(a=>a.addEventListener('click',()=>mobileMenu.classList.add('hidden')));

    // Lightbox
    const galleryContainer=document.getElementById('gallery-container');
    const lightbox=document.getElementById('lightbox');
    const lightboxImage=document.getElementById('lightbox-image');
    const lightboxTitle=document.getElementById('lightbox-title');
    const lightboxDescription=document.getElementById('lightbox-description');
    const closeLightboxButton=document.getElementById('close-lightbox');
    function openLightbox(src,t,d){ lightboxImage.src=src; lightboxTitle.textContent=t; lightboxDescription.textContent=d; lightbox.classList.remove('hidden'); }
    function closeLightbox(){ lightbox.classList.add('hidden'); }
    galleryContainer?.addEventListener('click',e=>{ const el=e.target.closest('.gallery-item'); if(el) openLightbox(el.dataset.src,el.dataset.title,el.dataset.description);});
    closeLightboxButton?.addEventListener('click',closeLightbox);
    lightbox?.addEventListener('click',e=>{ if(e.target===lightbox) closeLightbox(); });

    // Scroll animáció
    function initializeScrollAnimation(){
      const obs=new IntersectionObserver((entries)=>{
        entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('is-visible'); obs.unobserve(e.target);} });
      },{threshold:.1});
      document.querySelectorAll('.reveal-on-scroll').forEach(el=>obs.observe(el));
    }
    initializeScrollAnimation();

    const toTopButton=document.getElementById('to-top-button');
    const header=document.getElementById('main-header');
    window.addEventListener('scroll',()=>{
      header.classList.toggle('header-scrolled',window.scrollY>50);
      if(window.scrollY>window.innerHeight/2){ toTopButton.classList.remove('opacity-0','translate-y-5'); }
      else { toTopButton.classList.add('opacity-0','translate-y-5'); }
    });

    /* ---------- Galéria betöltése ---------- */
    window.addEventListener('DOMContentLoaded', () => {
      fetch('data/gallery.json')
        .then(r => r.json())
        .then(data => {
          galleryContainer.innerHTML = '';
          if (data.images?.length) {
            const safe = s => String(s ?? '').replace(/"/g, '&quot;');
            data.images.forEach((item, i) => {
              const title = item.title || item.cim || '';
              const desc  = item.description || item.leiras || '';

              galleryContainer.innerHTML += `
                <div
                  class="gallery-item group relative aspect-square overflow-hidden rounded-lg shadow-lg cursor-pointer reveal-on-scroll"
                  data-src="${safe(item.image)}"
                  data-title="${safe(title)}"
                  data-description="${safe(desc)}"
                  style="--delay:${i * 100}ms"
                >
                  <img src="${safe(item.image)}" alt="${safe(title)}"
                      class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">

                  <div class="absolute inset-0 bg-black/0 group-hover:bg-black/25 transition-colors duration-300"></div>

                  <div class="absolute inset-x-0 bottom-0 p-3">
                    <div class="backdrop-blur-md bg-black/40 text-white rounded-md px-3 py-2 shadow-md
                                opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-300">
                      <h4 class="text-sm font-semibold truncate">${safe(title)}</h4>
                      <p class="hidden sm:block text-xs text-white/85 mt-0.5">${safe(desc)}</p>
                    </div>
                  </div>
                </div>
              `;
            });
            initializeScrollAnimation();
          } else {
            galleryContainer.innerHTML = '<p class="text-center col-span-full">Jelenleg nincsenek képek a galériában.</p>';
          }
        })
        .catch(() => {
          galleryContainer.innerHTML = '<p class="text-center col-span-full text-red-500">Hiba történt a galéria betöltése közben.</p>';
        });
    });

<script>
  // ====== Megye térkép (Leaflet) – path fallback + BOM fix + name normalizer ======
  const initWorkMap = async () => {
    const mapEl = document.getElementById('work-map');
    if (!mapEl) return;

    const map = L.map('work-map', {
      scrollWheelZoom: true,
      dragging: true,
      zoomControl: true,
      attributionControl: false
    }).setView([47.1, 18.5], 7);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap & CARTO'
    }).addTo(map);

    // ---- több path próba: relatív + abszolút ----
    const tryUrls = (file) => ([
      `data/${file}`,
      `/data/${file}`,
      new URL(`data/${file}`, document.baseURI).href
    ]);

    // BOM levágás + JSON parse
    const parseJsonSafe = (txt, url) => {
      const noBom = txt.charCodeAt(0) === 0xFEFF ? txt.slice(1) : txt;
      try { return JSON.parse(noBom); }
      catch (e) {
        console.error('JSON parse hiba ->', url, e, 'minta:', noBom.slice(0, 300));
        throw new Error(`JSON parse hiba – ${url}`);
      }
    };

    // több URL-t próbál sorban, az első sikerest visszaadja
    const fetchFirstOk = async (candidates) => {
      let lastErr;
      for (const url of candidates) {
        try {
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const txt = await res.text();
          const json = parseJsonSafe(txt, url);
          console.info('Betöltve:', url);
          return json;
        } catch (e) {
          console.warn('Sikertelen:', url, e.message);
          lastErr = e;
        }
      }
      throw lastErr || new Error('Nem sikerült betölteni egyetlen forrásból sem.');
    };

    let geojson, loc;
    try {
      [geojson, loc] = await Promise.all([
        fetchFirstOk(tryUrls('hungary-counties.json')),
        fetchFirstOk(tryUrls('locations.json'))
      ]);
    } catch (e) {
      console.error('Térkép betöltési hiba:', e);
      mapEl.innerHTML = '<p class="text-center text-white">Hiba történt a térkép adatok betöltésekor.</p>';
      return;
    }

    // GeoJSON valid?
    if (!geojson?.type || !Array.isArray(geojson?.features)) {
      console.error('Hibás GeoJSON szerkezet:', geojson);
      mapEl.innerHTML = '<p class="text-center text-white">Hibás GeoJSON (features hiányzik).</p>';
      return;
    }

    // Név normalizáló: "Somogy megye" -> "Somogy", trim, duplaszóköz out
    const norm = (s) => String(s || '')
      .replace(/\bmegye\b/gi, '')
      .replace(/\s+/g, ' ')
      .trim();

    // Kiemelendő megyék kigyűjtése a locations-ból
    const highlighted = new Set();
    const completedCount = {};

    const addCompleted = (countyRaw) => {
      const county = norm(countyRaw);
      if (!county) return;
      highlighted.add(county);
      completedCount[county] = (completedCount[county] || 0) + 1;
    };

    if (Array.isArray(loc?.counties)) {
      loc.counties.forEach(co => {
        const cname = co.county_name || co.name || co.megye || co.megye_nev;
        (co.cities || []).forEach(c => { if (c?.completed) addCompleted(cname); });
      });
    } else if (Array.isArray(loc)) {
      loc.forEach(row => {
        const cname = row.county_name || row.county || row.megye;
        if (row?.completed) addCompleted(cname);
      });
    } else {
      console.warn('locations.json nem várt struktúra:', loc);
    }

    // Stílusok
    const baseStyle = { fillColor:'#e5e7eb', weight:1, color:'#ffffff', opacity:1, fillOpacity:0.5, className:'county-outline' };
    const hotStyle  = { fillColor:'#16a34a', weight:2, color:'#15803d', opacity:1, fillOpacity:0.6, className:'county-outline' };

    // Réteg felrajzolás
    const layer = L.geoJSON(geojson, {
      style: f => {
        const name = norm(f?.properties?.name);
        return highlighted.has(name) ? hotStyle : baseStyle;
      },
      onEachFeature: (feature, lyr) => {
        const name = norm(feature?.properties?.name) || 'Ismeretlen megye';
        const count = completedCount[name] || 0;

        // középre fixált tooltip
        lyr.bindTooltip(name, { permanent:true, direction:'center', className:'county-label' }).openTooltip();

        // hover
        lyr.on('mouseover', () => highlighted.has(name) ? lyr.setStyle({ fillColor:'#15803d' }) : lyr.setStyle({ fillOpacity:0.65 }));
        lyr.on('mouseout',  () => highlighted.has(name) ? lyr.setStyle({ fillColor:'#16a34a' }) : lyr.setStyle({ fillOpacity:0.5  }));

        // click -> zoom + popup
        lyr.on('click', () => {
          const b = lyr.getBounds();
          map.fitBounds(b, { padding:[20,20] });
          const msg = highlighted.has(name)
            ? `<b>${name}</b><br>Jelölt települések száma: <b>${count}</b>`
            : `<b>${name}</b><br>Még nincs jelölt munka.`;
          L.popup({ closeButton:true, autoClose:true })
            .setLatLng(b.getCenter()).setContent(msg).openOn(map);
        });
      }
    }).addTo(map);

    try { map.fitBounds(layer.getBounds(), { padding:[10,10] }); } catch {}
  };

  window.addEventListener('DOMContentLoaded', initWorkMap);
</script>

</body>
</html>

