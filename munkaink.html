<!DOCTYPE html>
<html lang="hu" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Munkáink | Eszes Tiszta Klíma Kft.</title>
  <link rel="icon" href="https://i.postimg.cc/xTYhg4gG/image.png" type="image/png">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts + Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <!-- Saját stílusok (lightbox + térkép + galéria) -->
  <link rel="stylesheet" href="/css/components.css" />

  <!-- Külső saját JS-ek -->
  <script src="/js/lightbox.js" defer></script>
  <script src="/js/work-map.js" defer></script>

  <style>
    body{font-family:'Inter',sans-serif}
    .reveal-on-scroll{opacity:0;transform:translateY(30px);transition:opacity .8s ease-out,transform .8s ease-out;transition-delay:var(--delay,0ms)}
    .reveal-on-scroll.is-visible{opacity:1;transform:translateY(0)}
    /* mobil "Több…" logikahoz */
    @media (max-width: 639px){ .mobile-hidden{ display: none !important; } }
  </style>
</head>

<body class="bg-gray-100 text-gray-800">

  <!-- Header (menü: Főoldal / Munkáink aktív) -->
  <header id="main-header" class="sticky top-0 left-0 right-0 z-50 p-4 bg-white/80 backdrop-blur-xl shadow">
    <div class="max-w-6xl mx-auto flex items-center justify-between rounded-full px-4 sm:px-6 py-2">
      <a href="/" class="flex items-center gap-2">
        <img src="https://i.postimg.cc/xTYhg4gG/image.png" alt="Cég logó" class="h-8">
        <span class="text-base sm:text-xl font-bold text-yellow-600">Eszes Tiszta Klíma Kft.</span>
      </a>
      <nav class="hidden md:flex items-center space-x-2">
        <a href="/" class="text-gray-700 hover:text-cyan-700 px-4 py-2 rounded-full font-semibold">Főoldal</a>
        <a href="/munkaink" class="bg-cyan-600 text-white px-5 py-2 rounded-full font-semibold hover:bg-cyan-700">Munkáink</a>
      </nav>
      <button id="mobile-menu-button" class="md:hidden text-gray-700">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/></svg>
      </button>
    </div>
    <div id="mobile-menu" class="hidden md:hidden bg-white/95 backdrop-blur-lg mt-2 rounded-2xl shadow-lg overflow-hidden max-w-6xl mx-auto">
      <a href="/" class="block text-center py-3 px-4 text-sm text-gray-600 hover:bg-cyan-50 font-semibold">Főoldal</a>
      <a href="/munkaink" class="block text-center py-3 px-4 text-sm bg-cyan-600 text-white font-semibold hover:bg-cyan-700">Munkáink</a>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="bg-cyan-700 text-white">
      <div class="container mx-auto px-6 pt-16 pb-10 text-center">
        <h1 class="text-4xl md:text-5xl font-black mb-3">Aktuális Munkáink</h1>
        <p class="text-cyan-100 max-w-2xl mx-auto">Valódi helyszínek, valódi eredmények – nézd meg a referenciáinkat és a térképet, hol jártunk már.</p>
      </div>
    </section>

    <!-- Galéria -->
    <section class="py-12 bg-white">
      <div class="container mx-auto px-6">
        <h2 class="text-2xl md:text-3xl font-black text-cyan-800 mb-6 text-center">Galéria</h2>
        <div id="gallery-container">
          <p class="gallery-loading text-center">Galéria betöltése...</p>
        </div>
      </div>
    </section>

    <!-- Térkép -->
    <section class="py-12 bg-cyan-700 text-white">
      <div class="container mx-auto px-6">
        <h2 class="text-2xl md:text-3xl font-black mb-4 text-center">Ahol már dolgoztunk</h2>
        <div id="work-map" class="mx-auto max-w-5xl"></div>
      </div>
    </section>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" class="fixed inset-0 z-[110] flex items-center justify-center bg-black bg-opacity-80 backdrop-blur-sm hidden transition-opacity duration-300">
    <div id="lightbox-content" class="relative max-w-4xl max-h-[90vh] w-full p-4">
      <button id="close-lightbox" aria-label="Bezárás">&times;</button>
      <img id="lightbox-image" src="" alt="" class="max-w-full max-h-[75vh] mx-auto rounded-lg shadow-2xl">
      <div id="lightbox-caption" class="text-center text-white mt-4">
        <h4 id="lightbox-title" class="text-xl font-bold"></h4>
        <p id="lightbox-description" class="text-gray-300"></p>
      </div>
    </div>
  </div>

  <footer class="bg-gray-800 text-white py-10">
    <div class="container mx-auto px-6 text-center">
      <p class="text-xl font-bold">Eszes Tiszta Klíma Kft.</p>
      <p class="text-gray-400">&copy; 2025 Minden jog fenntartva.</p>
    </div>
  </footer>

  <script>
    // Mobil menü
    const mobileMenuButton=document.getElementById('mobile-menu-button');
    const mobileMenu=document.getElementById('mobile-menu');
    mobileMenuButton?.addEventListener('click',()=>mobileMenu.classList.toggle('hidden'));
    mobileMenu?.querySelectorAll('a').forEach(a=>a.addEventListener('click',()=>mobileMenu.classList.add('hidden')));

    // Scroll animáció
    function initializeScrollAnimation(){
      const obs=new IntersectionObserver((entries)=>{
        entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('is-visible'); obs.unobserve(e.target);} });
      },{threshold:.1});
      document.querySelectorAll('.reveal-on-scroll').forEach(el=>obs.observe(el));
    }

    // Galéria betöltés (data/gallery.json + lightbox)
    window.addEventListener('DOMContentLoaded', () => {
      fetch('/data/gallery.json', {cache: 'no-store'})
        .then(r => r.json())
        .then(data => {
          const galleryContainer=document.getElementById('gallery-container');
          galleryContainer.innerHTML = '';
          if (data.images?.length) {
            const safe = s => String(s ?? '').replace(/"/g, '&quot;');

            data.images.forEach((item, i) => {
              const title = item.title || item.cim || '';
              const desc  = item.description || item.leiras || '';
              const hasCaption = (title && title.trim().length) || (desc && desc.trim().length);

              const card = document.createElement('div');
              card.className = 'gallery-item group relative overflow-hidden rounded-lg shadow-lg cursor-pointer reveal-on-scroll';
              card.style.setProperty('--delay', `${i*80}ms`);
              card.setAttribute('data-src', safe(item.image));
              card.setAttribute('data-title', safe(title));
              card.setAttribute('data-description', safe(desc));

              card.innerHTML = `
                <img src="${safe(item.image)}" alt="${safe(title || 'Galéria kép')}"
                     class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
                <div class="absolute inset-0 bg-black/0 group-hover:bg-black/25 transition-colors duration-300"></div>
                ${hasCaption ? `
                <div class="absolute inset-x-0 bottom-0 p-2">
                  <div class="backdrop-blur-md bg-black/40 text-white rounded px-2 py-1 shadow opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-300">
                    ${title ? `<h4 class="text-xs font-semibold truncate">${safe(title)}</h4>` : ``}
                    ${desc  ? `<p class="hidden sm:block text-[11px] text-white/85 mt-0.5">${safe(desc)}</p>` : ``}
                  </div>
                </div>` : ``}
              `;

              galleryContainer.appendChild(card);
            });

            // Lightbox
            document.querySelectorAll('.gallery-item').forEach(card=>{
              card.addEventListener('click',()=>{
                const src = card.getAttribute('data-src');
                const title = card.getAttribute('data-title') || '';
                const desc  = card.getAttribute('data-description') || '';
                if (window.openLightbox) window.openLightbox(src, title, desc);
              });
            });

            // Mobil "Több…" / "Kevesebb…" csak ha >4 kép
            const isMobile = window.matchMedia('(max-width: 639px)');
            const items = Array.from(document.querySelectorAll('.gallery-item'));
            const moreThanFour = items.length > 4;

            if (moreThanFour) {
              let expanded = false;
              const toggleWrap = document.createElement('div');
              toggleWrap.className = 'mt-4 text-center sm:hidden';
              const toggleBtn = document.createElement('button');
              toggleBtn.id = 'gallery-toggle-btn';
              toggleBtn.className = 'inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/90 text-cyan-800 font-semibold shadow-md active:scale-[0.98]';
              toggleBtn.innerHTML = '<span class="i">▼</span> <span class="t">Több…</span>';
              toggleWrap.appendChild(toggleBtn);
              galleryContainer.after(toggleWrap);

              function applyMobileClamp() {
                if (isMobile.matches) {
                  items.slice(4).forEach(el => el.classList.toggle('mobile-hidden', !expanded));
                  toggleWrap.classList.remove('hidden');
                } else {
                  items.forEach(el => el.classList.remove('mobile-hidden'));
                  expanded = true;
                  toggleWrap.classList.add('hidden');
                }
              }

              toggleBtn.addEventListener('click', (e)=>{
                e.preventDefault();
                e.stopPropagation();
                expanded = !expanded;
                applyMobileClamp();
                toggleBtn.innerHTML = expanded
                  ? '<span class="i">▲</span> <span class="t">Kevesebb…</span>'
                  : '<span class="i">▼</span> <span class="t">Több…</span>';
              });

              isMobile.addEventListener('change', applyMobileClamp);
              applyMobileClamp();
            } else {
              items.forEach(el => el.classList.remove('mobile-hidden'));
            }

            initializeScrollAnimation();
          } else {
            galleryContainer.innerHTML = '<p class="text-center">Jelenleg nincsenek képek a galériában.</p>';
          }
        })
        .catch(() => {
          document.getElementById('gallery-container').innerHTML = '<p class="text-center text-red-500">Hiba történt a galéria betöltése közben.</p>';
        });
    });
  </script>
</body>
</html>
